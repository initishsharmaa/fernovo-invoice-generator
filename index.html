<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fernovo Stays - Invoice Generator</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gloock&family=Sora:wght@100..800&display=swap" rel="stylesheet">
    
    <!-- Icons (Phosphor Icons) -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <!-- HTML2PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        body {
            font-family: 'Sora', sans-serif;
            background-color: #f5f5f5;
        }
        h1, h2, h3, .brand-font {
            font-family: 'Gloock', serif;
        }
        .invoice-container {
            width: 794px; /* A4 width in pixels approx */
            min-height: 1123px; /* A4 height */
            background: white;
            margin: 0 auto;
        }
        
        /* Print adjustments */
        @media print {
            body * {
                visibility: hidden;
            }
            #invoice-content, #invoice-content * {
                visibility: visible;
            }
            #invoice-content {
                position: absolute;
                left: 0;
                top: 0;
            }
        }
    </style>
</head>
<body class="text-gray-800 pb-10">

    <!-- Navbar -->
    <nav class="bg-indigo-900 text-white p-4 shadow-lg mb-8">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2">
                <i class="ph ph-bed text-yellow-400 text-2xl"></i>
                <span class="text-xl font-bold">Fernovo Stays Admin</span>
            </div>
            <button onclick="downloadPDF()" class="bg-yellow-500 hover:bg-yellow-600 text-indigo-900 px-4 py-2 rounded-lg font-semibold flex items-center gap-2 transition-colors">
                <i class="ph ph-download-simple text-lg"></i>
                Download PDF
            </button>
        </div>
    </nav>

    <div class="max-w-[1600px] mx-auto px-4 grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <!-- LEFT COLUMN: Controls -->
        <div class="lg:col-span-4 space-y-6">
            
            <!-- Booking Details -->
            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                <h2 class="text-lg font-bold text-gray-500 mb-4 flex items-center gap-2 font-sans">
                    <i class="ph ph-file-text"></i> Booking Details
                </h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Select Property</label>
                        <select id="propertyName" onchange="updateInvoice()" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                            <option value="Barod Fall Cottage">Barod Fall Cottage</option>
                            <option value="Saraswati Palace">Saraswati Palace</option>
                        </select>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Invoice #</label>
                            <div class="flex gap-1">
                                <input type="text" id="invoiceNumber" readonly class="w-full p-2 bg-gray-100 border border-gray-300 rounded-lg text-gray-500 cursor-not-allowed">
                                <button onclick="generateNewId()" class="bg-gray-200 p-2 rounded-lg hover:bg-gray-300 text-gray-600">
                                    <i class="ph ph-arrows-clockwise"></i>
                                </button>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Date</label>
                            <input type="date" id="date" onchange="updateInvoice()" class="w-full p-2 border border-gray-300 rounded-lg">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Guest Info -->
            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                <h2 class="text-lg font-bold text-gray-500 mb-4 flex items-center gap-2 font-sans">
                    <i class="ph ph-user"></i> Guest Information
                </h2>
                <div class="space-y-3">
                    <input type="text" id="customerName" placeholder="Guest Name" oninput="updateInvoice()" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                    <input type="text" id="phone" placeholder="Phone Number" oninput="updateInvoice()" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                    <input type="email" id="email" placeholder="Email Address" oninput="updateInvoice()" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none">
                </div>
            </div>

            <!-- Stay & Payment -->
            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                <h2 class="text-lg font-bold text-gray-500 mb-4 flex items-center gap-2 font-sans">
                    <i class="ph ph-calendar"></i> Stay & Payment
                </h2>
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Check In</label>
                            <input type="date" id="checkIn" onchange="updateInvoice()" class="w-full p-2 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Check Out</label>
                            <input type="date" id="checkOut" onchange="updateInvoice()" class="w-full p-2 border border-gray-300 rounded-lg">
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Total Stay Amount (₹)</label>
                        <input type="number" id="totalAmount" placeholder="0" oninput="updateInvoice()" class="w-full p-2 border border-gray-300 rounded-lg font-mono text-lg font-bold">
                    </div>

                    <div>
                        <div class="flex justify-between items-end mb-1">
                            <label class="block text-xs font-bold text-gray-500 uppercase">Advance Paid (₹)</label>
                            <button onclick="setStandardAdvance()" class="text-xs bg-indigo-50 text-indigo-700 px-2 py-1 rounded hover:bg-indigo-100 flex items-center gap-1 font-semibold">
                                <i class="ph ph-calculator"></i> Auto 30%
                            </button>
                        </div>
                        <input type="number" id="advanceAmount" placeholder="0" oninput="updateInvoice()" class="w-full p-2 border border-green-300 bg-green-50 rounded-lg font-mono text-lg font-bold text-green-800">
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Mode of Payment</label>
                        <select id="paymentMode" onchange="updateInvoice()" class="w-full p-2 border border-gray-300 rounded-lg">
                            <option value="UPI">UPI / GPay / PhonePe</option>
                            <option value="Cash">Cash</option>
                            <option value="Bank Transfer">Bank Transfer</option>
                            <option value="Card">Credit/Debit Card</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- RIGHT COLUMN: Invoice Preview -->
        <div class="lg:col-span-8 flex justify-center">
            <div id="invoice-content" class="invoice-container shadow-2xl p-12 relative flex flex-col">
                
                <!-- Header -->
                <div class="flex justify-between items-start border-b-2 border-indigo-900 pb-6 mb-8">
                    <div>
                        <h1 class="text-4xl text-indigo-900 uppercase tracking-tight mb-2">Fernovo Stays</h1>
                        <div class="text-sm text-gray-600 space-y-1">
                            <p class="font-bold text-lg text-gray-800" id="prev-propertyName">Barod Fall Cottage</p>
                            <p class="flex items-center gap-2"><i class="ph ph-map-pin"></i> Manali, Himachal Pradesh, India</p>
                            <p class="flex items-center gap-2"><i class="ph ph-phone"></i> +91 98765 43210</p>
                            <p class="flex items-center gap-2"><i class="ph ph-envelope"></i> bookings@fernovostays.com</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="bg-blue-50 px-6 py-4 rounded-lg border border-blue-100 inline-block text-left min-w-[200px]">
                            <h3 class="text-indigo-900 font-bold text-2xl brand-font">INVOICE</h3>
                            <p class="text-gray-500 mt-1 text-sm font-sans" id="prev-invoiceNumber">#INV-0000</p>
                            <p class="text-gray-500 text-sm font-sans">Date: <span id="prev-date"></span></p>
                        </div>
                    </div>
                </div>

                <!-- Bill To -->
                <div class="mb-8">
                    <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 font-sans">Invoice To</h3>
                    <div class="text-gray-800 font-sans">
                        <p class="font-bold text-xl" id="prev-customerName">Guest Name</p>
                        <p id="prev-phone"></p>
                        <p id="prev-email"></p>
                    </div>
                </div>

                <!-- Table -->
                <div class="mb-8">
                    <table class="w-full font-sans">
                        <thead>
                            <tr class="bg-gray-100 text-left">
                                <th class="p-3 text-xs font-bold text-gray-500 uppercase">Description</th>
                                <th class="p-3 text-xs font-bold text-gray-500 uppercase">Check In</th>
                                <th class="p-3 text-xs font-bold text-gray-500 uppercase">Check Out</th>
                                <th class="p-3 text-xs font-bold text-gray-500 uppercase text-right">Nights</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100">
                            <tr>
                                <td class="p-4">
                                    <p class="font-bold text-indigo-900 text-sm">Accommodation Charge</p>
                                    <p class="text-xs text-gray-500" id="prev-table-property">Barod Fall Cottage</p>
                                </td>
                                <td class="p-4 text-sm" id="prev-checkIn">-</td>
                                <td class="p-4 text-sm" id="prev-checkOut">-</td>
                                <td class="p-4 text-sm text-right font-bold" id="prev-nights">0</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Financials -->
                <div class="flex justify-end mb-12 font-sans">
                    <div class="w-1/2">
                        <div class="flex justify-between items-center mb-2 p-2">
                            <span class="text-gray-600">Total Amount</span>
                            <span class="font-bold text-lg" id="prev-total">₹0</span>
                        </div>
                        
                        <div class="flex justify-between items-center mb-2 bg-green-50 p-2 rounded text-green-800 border border-green-100">
                            <span class="flex items-center gap-2 text-sm font-bold">
                                <i class="ph ph-check-circle"></i> Advance Paid (<span id="prev-paymentMode">UPI</span>)
                            </span>
                            <span class="font-bold text-lg" id="prev-advance">- ₹0</span>
                        </div>

                        <div class="border-t-2 border-indigo-900 mt-4 pt-4 flex justify-between items-center">
                            <span class="text-indigo-900 font-bold text-xl uppercase">Balance Due</span>
                            <span class="text-indigo-900 font-bold text-3xl" id="prev-balance">₹0</span>
                        </div>
                        <div class="text-right mt-2 text-xs text-gray-400">
                            *Prices are inclusive of applicable taxes.
                        </div>
                    </div>
                </div>

                <!-- Footer / Terms -->
                <div class="mt-auto border-t border-gray-200 pt-6">
                    <h4 class="font-bold text-gray-800 mb-2 text-xs uppercase font-sans">Terms & Conditions</h4>
                    <ul class="text-[10px] text-gray-500 space-y-1 list-disc pl-4 text-justify font-sans">
                        <li><strong class="text-red-600">Cancellation Policy:</strong> Booking fees and advance payments are strictly <strong>NON-REFUNDABLE</strong> upon cancellation under any circumstances.</li>
                        <li><strong>Identification:</strong> All guests must present valid government-issued photo identification (Aadhar Card, Passport, Voter ID) upon check-in. PAN cards are not accepted.</li>
                        <li><strong>Check-in/Check-out:</strong> Standard Check-in: 12:00 PM | Check-out: 11:00 AM. Early/Late timings subject to availability and charges.</li>
                        <li><strong>Damages:</strong> Guests are responsible for any damage to property. Management reserves the right to charge for damages.</li>
                        <li><strong>Force Majeure:</strong> Fernovo Stays is not liable for service failure due to natural calamities (snow, landslides) or conditions beyond control.</li>
                    </ul>

                    <div class="mt-8 pt-8 flex justify-between items-end">
                        <div class="text-center">
                            <p class="text-xs text-gray-400 mb-6 font-sans">Guest Signature</p>
                            <div class="w-40 border-b border-gray-300"></div>
                        </div>
                        <div class="text-center">
                            <div class="brand-font text-2xl text-indigo-900 mb-1 opacity-50">Fernovo Stays</div>
                            <p class="text-xs text-gray-400 mb-1 font-sans">Authorized Signatory</p>
                            <div class="w-40 border-b border-gray-300"></div>
                        </div>
                    </div>
                    
                    <div class="text-center mt-6 text-[10px] text-gray-300 font-sans">
                        Thank you for choosing Fernovo Stays. We hope you had a pleasant stay!<br>
                        This is a system generated slip.
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Logic Script -->
    <script>
        // Init Date
        document.getElementById('date').valueAsDate = new Date();
        
        // Generate initial ID
        generateNewId();

        function generateNewId() {
            const id = `INV-${Math.floor(Math.random() * 10000) + 1000}`;
            document.getElementById('invoiceNumber').value = id;
            updateInvoice();
        }

        function setStandardAdvance() {
            const total = parseFloat(document.getElementById('totalAmount').value) || 0;
            const advance = Math.round(total * 0.30);
            document.getElementById('advanceAmount').value = advance;
            updateInvoice();
        }

        function updateInvoice() {
            // Get Values
            const propertyName = document.getElementById('propertyName').value;
            const invoiceNumber = document.getElementById('invoiceNumber').value;
            const date = document.getElementById('date').value;
            const customerName = document.getElementById('customerName').value;
            const phone = document.getElementById('phone').value;
            const email = document.getElementById('email').value;
            const checkIn = document.getElementById('checkIn').value;
            const checkOut = document.getElementById('checkOut').value;
            const total = parseFloat(document.getElementById('totalAmount').value) || 0;
            const advance = parseFloat(document.getElementById('advanceAmount').value) || 0;
            const paymentMode = document.getElementById('paymentMode').value;

            // Calculate Nights
            let nights = 0;
            if (checkIn && checkOut) {
                const start = new Date(checkIn);
                const end = new Date(checkOut);
                const diffTime = Math.abs(end - start);
                nights = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                if (nights === 0 && checkIn === checkOut) nights = 1;
            }

            // Calculate Balance
            const balance = total - advance;

            // Update DOM
            document.getElementById('prev-propertyName').innerText = propertyName;
            document.getElementById('prev-table-property').innerText = propertyName;
            document.getElementById('prev-invoiceNumber').innerText = invoiceNumber;
            document.getElementById('prev-date').innerText = date;
            
            document.getElementById('prev-customerName').innerText = customerName || 'Guest Name';
            document.getElementById('prev-phone').innerText = phone;
            document.getElementById('prev-email').innerText = email;

            document.getElementById('prev-checkIn').innerText = checkIn || '-';
            document.getElementById('prev-checkOut').innerText = checkOut || '-';
            document.getElementById('prev-nights').innerText = nights;

            document.getElementById('prev-total').innerText = '₹' + total.toLocaleString();
            document.getElementById('prev-advance').innerText = '- ₹' + advance.toLocaleString();
            document.getElementById('prev-balance').innerText = '₹' + (balance >= 0 ? balance : 0).toLocaleString();
            document.getElementById('prev-paymentMode').innerText = paymentMode;
        }

        function downloadPDF() {
            const element = document.getElementById('invoice-content');
            const invNum = document.getElementById('invoiceNumber').value;
            const guest = document.getElementById('customerName').value || 'Guest';
            const filename = `${invNum}_${guest.replace(/\s+/g, '_')}.pdf`;

            const opt = {
                margin: 0,
                filename: filename,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            // Temporary visual tweak for PDF generation if needed
            html2pdf().set(opt).from(element).save();
        }

        // Run once on load
        updateInvoice();
    </script>
</body>
</html>